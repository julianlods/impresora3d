{% extends "base.html" %}
{% block title %}Inicio — El Sultán del Plástico{% endblock %}

{% block content %}
<div class="text-center my-2">
	<h1 class="text-3xl md:text-4xl font-bold text-gray-100 mb-2">
		Catálogo de Productos
	</h1>
</div>

<div class="text-center mt-4">
	<div class="relative px-2 sm:px-8 overflow-x-hidden">
		<!-- Flecha izquierda -->
		<button id="prev" type="button"
			class="hidden sm:flex absolute left-1 sm:left-0 top-1/2 -translate-y-1/2 z-50
			       bg-white text-gray-900 shadow rounded-full p-2">
			&#10094;
		</button>

		<!-- Carrusel horizontal -->
		<div id="carousel"
			class="flex overflow-x-auto gap-4 scroll-smooth pb-4 scrollbar-hide snap-x snap-mandatory">
			{% for p in productos %}
				<div data-card class="min-w-[250px] max-w-[250px] snap-start flex-shrink-0 bg-gray-800 rounded-lg shadow hover:shadow-xl transition p-4">
					{% set src = p.image_url %}
					<div class="w-full bg-black rounded-lg" style="aspect-ratio: 4 / 3;">
						<img
							src="{{ src if src and src.startswith('http') else url_for('static', filename=(src or 'images/placeholder.png')) }}"
							alt="{{ p.name }}"
							class="w-full h-full object-contain rounded"
						>
					</div>

					<h3 class="text-lg font-bold text-yellow-400 mt-3">{{ p.name }}</h3>
					{% if p.description %}<p class="text-sm text-gray-300 line-clamp-3">{{ p.description }}</p>{% endif %}
					<div class="mt-2 flex items-center justify-between">
						{% if p.category %}<span class="text-xs text-gray-400">{{ p.category.name }}</span>{% endif %}
						{% if p.price %}<span class="text-sm font-semibold text-yellow-400">{{ p.price }}</span>{% endif %}
					</div>

					<a href="{{ url_for('producto', slug=p.slug) }}"
						class="mt-3 inline-block bg-white text-gray-900 border border-gray-200 hover:bg-gray-100 px-3 py-1 rounded-full font-semibold text-sm">
						VER
					</a>

				</div>
			{% else %}
				<p class="text-gray-300">No hay productos cargados.</p>
			{% endfor %}
		</div>

		<!-- Flecha derecha -->
		<button id="next" type="button"
			class="hidden sm:flex absolute right-1 sm:right-0 top-1/2 -translate-y-1/2 z-50
			       bg-white text-gray-900 shadow rounded-full p-2">
			&#10095;
		</button>
	</div>
</div>

<style>
	/* ocultar scrollbar del carrusel */
	.scrollbar-hide::-webkit-scrollbar { display: none; }
	.scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
	const carousel = document.getElementById('carousel');
	const prev = document.getElementById('prev');
	const next = document.getElementById('next');
	if (!carousel || !prev || !next) return;

	// calcular el paso: ancho de una card + gap horizontal
	const firstCard = carousel.querySelector('[data-card]');
	const styles = getComputedStyle(carousel);
	const gap = parseInt(styles.columnGap || styles.gap || '16', 10);
	const fallback = Math.max(280, Math.floor(carousel.clientWidth * 0.9));
	const step = firstCard ? firstCard.getBoundingClientRect().width + gap : fallback;

	const scrollByX = (dx) => {
		if (typeof carousel.scrollBy === 'function') {
			carousel.scrollBy({ left: dx, behavior: 'smooth' });
		} else {
			carousel.scrollLeft += dx;
		}
	};

	prev.addEventListener('click', () => scrollByX(-step));
	next.addEventListener('click', () => scrollByX(step));

	// mostrar flechas solo en >= sm (igual que las clases)
	const updateArrows = () => {
		const show = window.matchMedia('(min-width: 640px)').matches;
		prev.style.display = next.style.display = show ? 'flex' : 'none';
	};
	updateArrows();
	window.addEventListener('resize', updateArrows);
});
</script>
{% endblock %}
