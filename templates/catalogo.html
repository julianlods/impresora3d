{% extends "base.html" %}
{% block title %}Catálogo de productos — El Sultán del Plástico{% endblock %}

{% block content %}
<h2 class="text-2xl font-bold mb-6 text-amber-700">Catálogo de productos</h2>

{% if categorias %}
  <ul class="grid gap-5 sm:grid-cols-2 lg:grid-cols-3 justify-center max-w-6xl mx-auto">
    {% for cat in categorias %}
      {% set prods = cat.products|sort(attribute='name') %}
      {% if prods %}
        {% for p in prods %}
          <li class="bg-gray-800 rounded-lg overflow-hidden shadow hover:shadow-lg transition w-[14rem]">
            {% set src = p.image_url %}
            <a href="{{ url_for('producto', slug=p.slug) }}" class="block">
              <div class="w-full bg-black" style="aspect-ratio: 4 / 3;">
                <img
                  src="{{ src if src and src.startswith('http') else url_for('static', filename=(src or 'images/placeholder.png')) }}"
                  alt="{{ p.name }}"
                  class="w-full h-full object-contain"
                >
              </div>
            </a>
            <div class="p-3">
              <div class="mb-1">
                {% if cat.slug %}
                  <a href="{{ url_for('categoria', slug=cat.slug) }}"
                     class="inline-block text-[10px] px-2 py-0.5 rounded-full bg-gray-700 text-gray-200 hover:bg-gray-600">
                    {{ cat.name }}
                  </a>
                {% else %}
                  <span class="inline-block text-[10px] px-2 py-0.5 rounded-full bg-gray-700 text-gray-200">{{ cat.name }}</span>
                {% endif %}
              </div>
              <div class="flex items-start justify-between gap-2">
                <h3 class="font-semibold text-sm leading-snug">
                  <a href="{{ url_for('producto', slug=p.slug) }}" class="hover:underline">{{ p.name }}</a>
                </h3>
                {% if p.price %}
                  <span class="text-yellow-400 text-xs font-semibold whitespace-nowrap">{{ p.price }}</span>
                {% endif %}
              </div>
              {% if p.description %}
                <p class="text-gray-300 text-xs mt-1 line-clamp-2">{{ p.description }}</p>
              {% endif %}
            </div>
          </li>
        {% endfor %}
      {% else %}
        <li class="bg-gray-800 rounded-lg overflow-hidden shadow flex flex-col items-center justify-center p-5 text-gray-400 w-[14rem] h-[12rem]">
          <span class="text-base font-semibold">{{ cat.name }}</span>
          <span class="text-xs">Sin productos</span>
        </li>
      {% endif %}
    {% endfor %}
  </ul>
{% else %}
  <p class="text-gray-300">No hay categorías cargadas.</p>
{% endif %}
{% endblock %}
